<?xml version="1.0"?>
<block>
  <name>Max Power</name>
  <key>mesa_MaxPower</key>
  <category>[mesa]</category>
  <import>import mesa</import>
  <make>mesa.MaxPower($sampleRate, $fft_size, $squelchThreshold, $framesToAvg, $produceOut,$stateThreshold, $holdUpSec)</make>
	<callback>setSquelchThreshold($squelchThreshold)</callback>
	<callback>setStateThreshold($stateThreshold)</callback>
	<callback>setHoldTime($holdUpSec)</callback>
	<param>
		<name>Sample Rate</name>
		<key>sampleRate</key>
		<value>samp_rate</value>
		<type>float</type>
	</param>

	<param>
		<name>FFT Size</name>
		<key>fft_size</key>
		<value>1024</value>
		<type>int</type>
	</param>

	<param>
		<name>Squelch Threshold</name>
		<key>squelchThreshold</key>
		<value>-80.0</value>
		<type>float</type>
	</param>
	
	<param>
		<name>Frames to Avg</name>
		<key>framesToAvg</key>
		<value>6</value>
		<type>int</type>
	</param>
	
	<param>
		<name>State Notify Threshold</name>
		<key>stateThreshold</key>
		<value>-65.0</value>
		<type>float</type>
	</param>
	
	<param>
		<name>Detect Hold Time (s)</name>
		<key>holdUpSec</key>
		<value>10.0</value>
		<type>float</type>
	</param>
	
	<param>
		<name>Produce Out Msg</name>
		<key>produceOut</key>
		<type>enum</type>
		<option>
			<name>No</name>
			<key>False</key>
		</option>
		<option>
			<name>Yes</name>
			<key>True</key>
		</option>
	</param>
  <!-- Make one 'sink' node per input. Sub-nodes:
       * name (an identifier for the GUI)
       * type
       * vlen
       * optional (set to 1 for optional inputs) -->
  <sink>
    <name>in</name>
    <type>complex</type>
    <optional>1</optional>
  </sink>

  <sink>
    <name>msgin</name>
    <type>message</type>
    <optional>1</optional>
  </sink>

  <!-- Make one 'source' node per output. Sub-nodes:
       * name (an identifier for the GUI)
       * type
       * vlen
       * optional (set to 1 for optional outputs) -->
  <source>
    <name>out</name>
    <type>message</type>
    <optional>1</optional>
  </source>
  
  <source>
    <name>maxpower</name>
    <type>message</type>
    <optional>1</optional>
  </source>
  <source>
    <name>state</name>
    <type>message</type>
    <optional>1</optional>
  </source>
	<doc>
This block monitors the input block for the maximum power seen.  This is output in a "maxpower" meta tag in the maxpower connector, and also output on the out port along with the data block.  For compatibility with the input selector block, a "decisionvalue" tag is also in the metadata that matches maxpower.

The block can also be used to send a state (1/0) message if the detected power is above the specified notify threshold.

NOTE: For performance purposes, if you don't need the full data stream, set 'Produce Out Msg' to No.
	</doc>
</block>
